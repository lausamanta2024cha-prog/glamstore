{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Checkout ‚Äî GlamStore</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Comic+Neue:ital,wght@1,700&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Comic Neue', cursive;
      background-color: #fffafc;
      color: #880e4f;
      display: flex;
      margin: 0;
    }
    
    .sidebar {
      background-color: #fce4ec;
      padding: 2rem;
      width: 240px;
      height: 100vh;
      position: fixed;
      display: flex;
      flex-direction: column;
      align-items: center;
      text-align: center;
      border-right: 2px solid #f8bbd0;
      box-shadow: 2px 0 10px rgba(0,0,0,0.1);
      z-index: 1000;
      overflow-y: auto;
    }
    
    .logo {
      width: 100px;
      border-radius: 50%;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
      margin-bottom: 1rem;
    }
    
    .sidebar h1 {
      color: #ad1457;
      font-size: 1.8rem;
      margin: 0.5rem 0;
    }
    
    .sidebar p {
      color: #d81b60;
      font-size: 1rem;
      margin-bottom: 2rem;
    }
    
    .sidebar nav ul {
      list-style: none;
      padding: 0;
      width: 100%;
    }
    
    .sidebar nav a {
      display: block;
      padding: 0.8rem 1.5rem;
      margin-bottom: 0.8rem;
      text-decoration: none;
      color: #880e4f;
      font-weight: bold;
      border-radius: 25px;
      transition: background-color 0.3s, color 0.3s;
    }
    
    .sidebar nav a:hover {
      background-color: #f8bbd0;
      color: #fff;
    }
    
    .main-content {
      margin-left: 240px;
      padding: 2rem;
      width: calc(100% - 240px);
      min-height: 100vh;
    }


    h2.titulo-checkout {
      font-size: 2.2rem;
      color: #c2185b;
      border-bottom: 3px solid #f48fb1;
      padding-bottom: 0.5rem;
      margin-bottom: 2rem;
    }
    
    .checkout-container {
      display: flex;
      flex-wrap: wrap;
      gap: 2rem;
      justify-content: space-between;
    }

    .formulario {
      flex: 1 1 55%;
      background: #fff5f8;
      padding: 2rem;
      border-radius: 16px;
      box-shadow: 0 4px 10px rgba(212, 144, 192, 0.2);
    }

    .resumen {
      flex: 1 1 40%;
      background: #fff5f8;
      padding: 2rem;
      border-radius: 16px;
      position: sticky; /* Hacemos que el resumen sea "pegajoso" */
      top: 2rem; /* Se pegar√° a 2rem del borde superior */
      align-self: flex-start; /* Evita que se estire verticalmente */
      box-shadow: 0 4px 10px rgba(212, 144, 192, 0.2);
    }

    h2, h3 {
      font-size: 1.8rem;
      color: #f06292;
      margin-bottom: 1rem;
      text-shadow: 1px 1px 2px #fce4ec;
    }

    h3 {
      font-size: 1.4rem;
      color: #d81b60;
      margin-top: 2rem;
    }

    form label {
      display: block;
      margin-top: 1rem;
      font-weight: bold;
      color: #ad1457;
    }

    form input, form select {
      width: 100%;
      padding: 0.6rem;
      margin-top: 0.4rem;
      border-radius: 8px;
      border: 1px solid #f8bbd0;
      background-color: #fff5f8;
      color: #ad1457;
      font-weight: bold;
    }

    input[type="radio"], input[type="checkbox"] {
      accent-color: #f48fb1;
      margin-right: 0.5rem;
    }

    .btn-finalizar {
      margin-top: 2rem;
      background: #f48fb1;
      color: white;
      padding: 0.8rem 1.6rem;
      border-radius: 10px;
      font-weight: bold;
      font-size: 1rem;
      border: none;
      cursor: pointer;
      transition: background 0.3s;
    }

    .btn-finalizar:hover {
      background: #ec407a;
    }

    .producto-resumen {
      background: #fff5f8;
      padding: 1rem;
      border-radius: 12px;
      margin-bottom: 1rem;
      box-shadow: 0 2px 6px rgba(213, 143, 191, 0.1);
    }

    .producto-resumen p {
      font-size: 1rem;
      margin: 0.4rem 0;
    }

    .btn-volver {
      display: inline-block;
      margin-top: 1rem;
      color: #ec407a;
      text-decoration: none;
      font-weight: bold;
      font-size: 1rem;
    }

    /* Estilos para la secci√≥n de pago */
    .metodos-pago {
      display: flex;
      flex-direction: column;
      gap: 1rem;
      margin-top: 1rem;
    }
    .metodo-pago-opcion {
      background: #fff5f8;
      padding: 1rem;
      border-radius: 12px;
      border: 2px solid #fce4ec;
      cursor: pointer;
      transition: border-color 0.3s, box-shadow 0.3s;
    }
    .metodo-pago-opcion:hover {
      border-color: #f48fb1;
    }
    .metodo-pago-opcion.seleccionado {
      border-color: #ec407a;
      box-shadow: 0 0 8px rgba(168, 85, 247, 0.3);
    }
    .metodo-pago-opcion label {
      display: flex;
      align-items: center;
      gap: 0.8rem;
      font-weight: bold;
      color: #ad1457;
    }
    .pago-detalles {
      display: none;
      margin-top: 1.5rem;
      padding: 1.5rem;
      background: #fff;
      border-radius: 12px;
      border: 1px solid #e0cce3;
    }
    .pago-detalles h4 {
      color: #f06292;
      margin-bottom: 1rem;
    }
    .pago-detalles p {
      margin-bottom: 1rem;
    }

    @media (max-width: 768px) {
      h2.titulo-checkout {
      font-size: 2.2rem;
      color: #c2185b;
      border-bottom: 3px solid #f48fb1;
      padding-bottom: 0.5rem;
      margin-bottom: 2rem;
    }
    
    .checkout-container {
        flex-direction: column;
      }

      .formulario, .resumen {
        flex: 1 1 100%;
      }
    }
  </style>
</head>
<body>

  <!-- Barra lateral -->
  <aside class="sidebar">
    <img src="{% static 'img/logoglam.png' %}" alt="Logo GlamStore" class="logo">
    {% if request.session.usuario_nombre %}
      <a href="{% url 'perfil' %}" style="text-decoration: none; color: inherit;">
        <h1>¬°Hola, {{ request.session.usuario_nombre }}!</h1>
      </a>
      <p>Qu√© bueno verte de nuevo ‚ú®</p>
    {% else %}
      <h1>Bienvenida a GlamStore</h1>
      <p>Tu espacio de moda, color y alegr√≠a</p>
    {% endif %}
    
    <nav>
      <ul>
        <li><a href="{% url 'tienda' %}">‚Üê Volver a Tienda</a></li>
        {% if request.session.usuario_nombre %}
          <li><a href="{% url 'perfil' %}">Mi Perfil</a></li>
        {% else %}
          <li><a href="{% url 'login' %}">Iniciar Sesi√≥n</a></li>
        {% endif %}
        <li><a href="{% url 'ver_carrito' %}">Carrito</a></li>
      </ul>
    </nav>
  </aside>

  <!-- Contenido principal -->
  <main class="main-content">
    <h2 class="titulo-checkout">Finalizar Compra</h2>
    
    <div class="checkout-container">
    <section class="formulario">
      <form method="POST" action="{% url 'simular_pago' %}">
        {% csrf_token %}

        <h3>1. DATOS PERSONALES</h3>
        <label>Correo</label>
        <input type="email" name="correo" required>

        <label>Nombre</label>
        <input type="text" name="nombre" required>

        <label>Apellidos</label>
        <input type="text" name="apellidos" required>

        <label>Tipo de documento</label>
        <select name="tipo_documento" required>
          <option value="">Elige una opci√≥n...</option>
          <option value="CC">C√©dula</option>
          <option value="TI">Tarjeta de Identidad</option>
          <option value="CE">C√©dula Extranjera</option>
        </select>

        <label>Documento</label>
        <input type="text" name="documento" required>

        <label>Tel√©fono / M√≥vil</label>
        <input type="tel" name="telefono" required>

        <h3>2. ENTREGA</h3>
        <label>Departamento</label>
        <select name="departamento" required>
          <option value="">Selecciona tu departamento</option>
          <option value="Cundinamarca">Cundinamarca</option>
          <option value="Bogot√° D.C.">Bogot√° D.C.</option>
        </select>

        <label>Municipio</label>
        <select name="municipio" required>
          <option value="">Selecciona tu municipio</option>
          <option value="Soacha">Soacha</option>
          <option value="Bogot√°">Bogot√°</option>
        </select>

        <label>Direcci√≥n</label>
        <input type="text" name="direccion" required>

        <label>Informaci√≥n adicional</label>
        <input type="text" name="info_adicional">

        <label>Barrio</label>
        <input type="text" name="barrio" required>

        <label>Nombre de quien recibe</label>
        <input type="text" name="nombre_receptor" required>

        <h3>3. M√âTODO DE ENTREGA</h3>

        <label><input type="radio" name="pago_envio" value="ahora" checked> Pagar env√≠o ahora (Total + $10.000)</label>
        <label><input type="radio" name="pago_envio" value="contra_entrega"> Pagar env√≠o contra entrega</label>
        <h3>4. PAGO</h3>
        <div class="metodos-pago">
          <div class="metodo-pago-opcion">
            <label><input type="radio" name="metodo_pago" value="nequi_daviplata" required> üì± Pagar con Nequi / Daviplata</label>
          </div>
          <div class="metodo-pago-opcion">
            <label><input type="radio" name="metodo_pago" value="consignacion"> üè¶ Consignaci√≥n Bancaria</label>
          </div>
          <div class="metodo-pago-opcion">
            <label><input type="radio" name="metodo_pago" value="efecty"> üíµ Pago en Efecty</label>
          </div>
        </div>

        <!-- Detalles para Nequi/Daviplata -->
        <div id="detalles_nequi_daviplata" class="pago-detalles">
          <h4>Pagar con Nequi / Daviplata</h4>
          <label for="celular_pago">N√∫mero de celular:</label>
          <input type="tel" id="celular_pago" name="celular_pago" placeholder="Tu n√∫mero de Nequi o Daviplata">
          <label for="clave_dinamica">Clave din√°mica:</label>
          <input type="text" id="clave_dinamica" name="clave_dinamica" placeholder="Ingresa tu clave din√°mica">
        </div>

        <!-- Detalles para Consignaci√≥n -->
        <div id="detalles_consignacion" class="pago-detalles">
          <h4>Pagar con Consignaci√≥n Bancaria</h4>
          <p>Realiza la transferencia a la siguiente cuenta y adjunta el comprobante:</p>
          <p><strong>Cuenta de Ahorros Bancolombia:</strong> 123-456789-00 a nombre de Glam Store.</p>
          <label for="referencia_pago">C√≥digo de referencia de pago:</label>
          <input type="text" id="referencia_pago" name="referencia_pago" placeholder="Ingresa el n√∫mero de referencia">
        </div>

        <!-- Detalles para Efecty -->
        <div id="detalles_efecty" class="pago-detalles">
          <h4>Pagar en Efecty</h4>
          <p>Dir√≠gete a tu punto Efecty m√°s cercano y presenta el siguiente c√≥digo para realizar el pago:</p>
          <p><strong>C√≥digo de pago:</strong> 987-654-321</p>
        </div>

        <!-- Bot√≥n final -->
        <button type="submit" class="btn-finalizar">Continuar y hacer el pago ‚ú®</button>
      </form>
    </section>

    <section class="resumen">
      <h2>RESUMEN DE LA COMPRA</h2>
      {% for item in carrito %}
        <div class="producto-resumen">
          <p><strong>{{ item.producto.nombreProducto }}</strong></p>
          <p>{{ item.cantidad }} unidad(es)</p>
          <p>${{ item.subtotal }}</p>
        </div>
      {% endfor %}
      <hr>
      <p>Subtotal: <strong id="subtotal-valor">${{ total }}</strong></p>
      <p id="costo-envio-resumen" style="display: block;">Env√≠o: <strong>$10.000</strong></p>
      <p>Total: <strong id="total-valor">${{ total|add:10000 }}</strong></p>
      <a href="{% url 'tienda' %}" class="btn-volver">‚Üê Seguir comprando</a>
    </section>
    </div>
    
    <footer class="pie" style="margin-top: 3rem; text-align: center; color: #888;">
      <p>&copy; 2025 GlamStore ‚Äî Belleza con estilo</p>
    </footer>
  </main>

  <!-- JS para mostrar secciones progresivamente -->
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const metodosPago = document.querySelectorAll('input[name="metodo_pago"]');
      const detallesPago = document.querySelectorAll('.pago-detalles');
      const opcionesPago = document.querySelectorAll('.metodo-pago-opcion');

      metodosPago.forEach(radio => {
  radio.addEventListener('change', function() {
    // Ocultar todos los detalles y quitar la clase 'seleccionado'
    detallesPago.forEach(detalle => detalle.style.display = 'none');
    opcionesPago.forEach(opcion => opcion.classList.remove('seleccionado'));

    // Mostrar el detalle correspondiente y marcar como seleccionado
    if (this.checked) {
      const idDetalle = 'detalles_' + this.value;
      const detalleSeleccionado = document.getElementById(idDetalle);
      if (detalleSeleccionado) {
        detalleSeleccionado.style.display = 'block';
        this.closest('.metodo-pago-opcion').classList.add('seleccionado');
      }
    }
  }); 
});

      // L√≥gica para actualizar el total con el env√≠o
      const radiosEnvio = document.querySelectorAll('input[name="pago_envio"]');
      const costoEnvioResumen = document.getElementById('costo-envio-resumen');
      const totalValor = document.getElementById('total-valor');
      const subtotal = parseFloat('{{ total }}');
      const costoEnvio = 10000;

      function actualizarTotal() {
        const pagoAhora = document.querySelector('input[name="pago_envio"][value="ahora"]').checked;
        
        if (pagoAhora) {
          costoEnvioResumen.style.display = 'block';
          totalValor.textContent = '$' + (subtotal + costoEnvio).toLocaleString('es-CO');
        } else {
          costoEnvioResumen.style.display = 'none';
          totalValor.textContent = '$' + subtotal.toLocaleString('es-CO');
        }
      }

      radiosEnvio.forEach(radio => {
        radio.addEventListener('change', actualizarTotal);
      });

 });
  </script>
</body>
</html>
